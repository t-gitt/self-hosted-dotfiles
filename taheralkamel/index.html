<!-- "The only secure truth men have is that which they themselves create and dramatize." -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
	
	<!-- Meta tags -->
	<title>taher</title>
	<meta name="description" content="Software & Devops Engineer | personal website">
	<meta property="og:title" content="taher">
	<meta property="og:description" content="Software & Devops Engineer | personal website">
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://taheralkamel.com">
	<meta name="theme-color" content="#1e1e2e">
	
	<!-- Styles -->
	<link rel="stylesheet" href="style.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>
	<!-- i3wm-style status bar -->
	<div class="status-bar">
		<div class="workspace-indicator">
			<div class="workspace active">1</div>
		</div>
		<div class="system-info">
			<span class="info-item" id="spotify-status">♪ connecting...</span>
			<span class="info-item" id="current-time">00:00</span>
			<a href="https://github.com/t-gitt/self-hosted-dotfiles/tree/main/taheralkamel" target="_blank" class="info-item" style="color: var(--text-muted); text-decoration: none;">src</a>
		</div>
	</div>

	<!-- Main window container -->
	<div class="wm-container">
		<div class="terminal-window">
			<!-- Terminal content -->
			<div class="terminal-content">
				<!-- Terminal prompt -->
				<div class="prompt-line">
					<div><span class="prompt">❯</span> <span style="color: var(--text-muted);">whoami</span></div>
				</div>
				
				<!-- Profile information -->
				<div class="profile" style="color: var(--text-primary);" id="initial-about">
				</div>
                <p>
                    <span style="color: var(--accent-color);">→ Resume:</span> <a href="/taheralkamelresume.pdf" target="_blank" style="color: var(--text-primary); text-decoration: underline;">View PDF</a>
                    <br>
                    <br>
                    Welcome to my terminal-style page! Type <a href="#" onclick="executeCommand('help'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">help</a> to get a list of available commands.
                    <br>
                    <br>
                </p>
				
				<!-- Terminal output area -->
				<div id="terminal-output">
					<!-- Initial links command -->
					<div style="margin-bottom: 16px; color: var(--text-muted);">
						<span class="prompt">❯</span> <span style="color: var(--text-muted);">links</span>
					</div>
					
					<div style="margin-bottom: 16px; color: var(--text-primary);" id="initial-links">
					</div>
				</div>
				
				<!-- Input prompt line -->
				<div id="input-line">
					<div style="display: flex; align-items: center;">
						<label for="terminal-input" class="prompt" style="color: var(--accent-color); margin-right: 8px; font-weight: bold;">❯</label>
					<span style="margin-left: 4px; flex: 1; position: relative;">
						<input type="text" id="terminal-input" autocomplete="off" aria-label="Terminal command input" style="
							background: transparent; 
							border: none; 
							outline: none; 
							color: var(--text-primary); 
							font-family: inherit; 
							font-size: inherit; 
							width: 100%;
							caret-color: transparent;
						" placeholder="">
						<span id="custom-cursor" style="
							position: absolute;
							height: 2px;
							width: 8px;
							background: var(--accent-color);
							bottom: 2px;
							left: 0px;
							animation: blink 1s infinite;
							pointer-events: none;
						"></span>
					</span>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// ===== CONFIGURATION =====
		const MOBILE_BREAKPOINT = 768;
		const KEYBOARD_THRESHOLD = 0.8;
		
		// ===== UTILITY FUNCTIONS =====
		const isMobile = () => window.innerWidth <= MOBILE_BREAKPOINT;
		
		// ===== STATUS BAR =====
		function updateTime() {
			const now = new Date();
			const time = now.toLocaleTimeString('de-DE', { 
				timeZone: 'Europe/Berlin',
				hour12: false, 
				hour: '2-digit', 
				minute: '2-digit' 
			});
			document.getElementById('current-time').textContent = `${time} Köln`;
		}
		
		async function updateSpotifyStatus() {
			const statusElement = document.getElementById('spotify-status');
			
			try {
				const response = await fetch('/api/spotify/current-track');
				const data = await response.json();
				
				if (data.error) {
					statusElement.textContent = data.display || '♪ error';
					statusElement.style.color = 'var(--text-muted)';
					return;
				}
				
				const displayText = isMobile() 
					? (data.mobileDisplay || data.display || '♪ offline')
					: (data.display || '♪ offline');
				
				statusElement.textContent = displayText;
				
				if (data.external_url) {
					statusElement.style.cursor = 'pointer';
					statusElement.style.color = 'var(--accent-color)';
					statusElement.onclick = () => window.open(data.external_url, '_blank');
				} else {
					statusElement.style.cursor = 'default';
					statusElement.style.color = 'var(--text-muted)';
					statusElement.onclick = null;
				}
				
			} catch (error) {
				console.error('Failed to fetch Spotify status:', error);
				statusElement.textContent = '♪ offline';
				statusElement.style.color = 'var(--text-muted)';
			}
		}
		
		updateTime();
		updateSpotifyStatus();
		setInterval(updateTime, 1000);
		setInterval(updateSpotifyStatus, 30000); // Update every 30 seconds

		// ===== TERMINAL INITIALIZATION =====
		const terminalInput = document.getElementById('terminal-input');
		const terminalOutput = document.getElementById('terminal-output');
		const commandHistory = [];
		let historyIndex = -1;

		// ===== CONTENT DEFINITIONS =====
		const calculateYearsOfExperience = () => {
			const startYear = 2020;
			const currentYear = new Date().getFullYear();
			return currentYear - startYear;
		};
		
		const MESSAGES = {
			about: `<span style="color: var(--name-color); font-weight: bold;">Taher Alkamel</span><br>
<span style="color: var(--accent-color);">Software & Devops Engineer</span><br>
<br>
With over ${calculateYearsOfExperience()} years of experience in designing, building, and scaling robust backend systems, I specialize in Python, Ruby, Go, and modern web technologies. Passionate about open-source software and minimalist solutions. I lead teams to deliver clean, efficient, and impactful code.<br>`,
			
			links: `<span style="color: var(--accent-color);">Social Links:</span><br>
<span style="color: var(--accent-color);">→</span> GitHub: <a href="https://github.com/t-gitt" target="_blank" style="color: var(--text-primary); text-decoration: underline;">github.com/t-gitt</a><br>
<span style="color: var(--accent-color);">→</span> Medium: <a href="https://medium.com/@taheralkamel" target="_blank" style="color: var(--text-primary); text-decoration: underline;">medium.com/@taheralkamel</a><br>
<span style="color: var(--accent-color);">→</span> LinkedIn: <a href="http://www.linkedin.com/in/taheralkamel/" target="_blank" style="color: var(--text-primary); text-decoration: underline;">linkedin.com/in/taheralkamel</a><br>`,
			
			help: `Available commands:<br>
<a href="#" onclick="executeCommand('help'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">help</a>     - Show this help message<br>
<a href="#" onclick="executeCommand('whoami'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">whoami</a>   - About me<br>
<a href="#" onclick="executeCommand('links'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">links</a>    - Show social links<br>
<a href="#" onclick="executeCommand('contact'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">contact</a>  - Contact information<br>
<a href="#" onclick="executeCommand('music'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">music</a>    - Song tracks I listen to<br>
<a href="#" onclick="executeCommand('resume'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">resume</a>   - View resume<br>
<a href="#" onclick="executeCommand('donate'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">donate</a>   - Support my work<br>
<a href="#" onclick="executeCommand('clear'); return false;" style="color: var(--accent-color); text-decoration: underline; cursor: pointer;">clear</a>    - Clear terminal`,
			
			contact: `<span style="color: var(--accent-color);">Contact Information:</span><br>
<span style="color: var(--accent-color);">@</span> Email: <a href="mailto:taheralkamel@gmail.com" style="color: var(--text-primary); text-decoration: underline;">taheralkamel@gmail.com</a><br>`,
			
			donate: `<span style="color: var(--accent-color);">Support My Work:</span><br>
<br>
<span style="color: var(--accent-color);">$</span> PayPal:<br>
<a href="https://www.paypal.com/paypalme/Taheralkamel" target="_blank" style="color: var(--text-primary); text-decoration: underline;">paypal.me/Taheralkamel</a><br>
<br>
<span style="color: var(--accent-color);">₿</span> Bitcoin:<br>
<span style="color: var(--text-primary); font-family: monospace; background: var(--bg-tertiary); padding: 2px 4px; border-radius: 3px;">bc1qawj2lp8kxzf5n9hew7s72sq2l4e2q72643rgs0</span>
<button onclick="navigator.clipboard.writeText('bc1qawj2lp8kxzf5n9hew7s72sq2l4e2q72643rgs0'); this.textContent='Copied!'" style="background: var(--accent-color); color: var(--bg-secondary); border: none; padding: 2px 6px; margin-left: 8px; border-radius: 3px; cursor: pointer; font-size: 10px;">Copy</button><br>`
		};

		// ===== MOBILE SCROLL HANDLING =====
		let isKeyboardOpen = false;
		let initialViewportHeight = window.innerHeight;

		function scrollToBottom() {
			const terminalContent = document.querySelector('.terminal-content');
			setTimeout(() => {
				terminalContent.scrollTop = terminalContent.scrollHeight;
			}, 50);
		}

		function scrollToShowInput() {
			const inputLine = document.getElementById('input-line');
			
			if (isMobile() && isKeyboardOpen) {
				setTimeout(() => {
					inputLine.scrollIntoView({ 
						behavior: 'auto',
						block: 'nearest'
					});
				}, 100);
			} else {
				scrollToBottom();
			}
		}

		function handleViewportChange() {
			if (!isMobile()) return;
			
			const currentHeight = window.innerHeight;
			const wasKeyboardOpen = isKeyboardOpen;
			
			isKeyboardOpen = currentHeight < initialViewportHeight * KEYBOARD_THRESHOLD;
			
			if (isKeyboardOpen && !wasKeyboardOpen) {
				setTimeout(scrollToShowInput, 300);
			} else if (!isKeyboardOpen && wasKeyboardOpen) {
				setTimeout(scrollToBottom, 100);
			}
		}

		function updateViewportHeight() {
			setTimeout(() => {
				initialViewportHeight = window.innerHeight;
				handleViewportChange();
			}, 500);
		}

		// ===== CUSTOM CURSOR =====
		const customCursor = document.getElementById('custom-cursor');
		
		// Cache canvas for cursor positioning to avoid repeated DOM creation
		const cursorCanvas = document.createElement('canvas');
		const cursorContext = cursorCanvas.getContext('2d');
		cursorContext.font = '14px JetBrains Mono, monospace';
		
		function updateCursorPosition() {
			const textWidth = cursorContext.measureText(terminalInput.value).width;
			customCursor.style.left = textWidth + 'px';
		}

		// ===== EVENT LISTENERS =====
		terminalInput.focus();
		document.addEventListener('click', () => terminalInput.focus());
		window.addEventListener('resize', handleViewportChange);
		window.addEventListener('orientationchange', updateViewportHeight);
		terminalInput.addEventListener('input', updateCursorPosition);
		terminalInput.addEventListener('keyup', updateCursorPosition);
		
		terminalInput.addEventListener('focus', () => {
			if (isMobile()) {
				setTimeout(() => {
					if (window.innerHeight < initialViewportHeight * KEYBOARD_THRESHOLD) {
						isKeyboardOpen = true;
						scrollToShowInput();
					}
				}, 400);
			}
		});

		// ===== MEDIA FUNCTIONS =====
		function formatDuration(ms) {
			const minutes = Math.floor(ms / 60000);
			const seconds = ((ms % 60000) / 1000).toFixed(0);
			return minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
		}
		
		async function showTopTracks(timeRange = 'medium_term') {
			try {
				const [recentResponse, topResponse] = await Promise.all([
					fetch('/api/spotify/recent-tracks?limit=10'),
					fetch(`/api/spotify/top-tracks?time_range=${timeRange}&limit=10`)
				]);
				
				const recentData = await recentResponse.json();
				const topData = await topResponse.json();
				
				if (recentData.error || topData.error) {
					return `<span style="color: #f38ba8;">Error: ${recentData.error || topData.error}</span><br>Try visiting <a href="/auth/spotify" target="_blank" style="color: var(--accent-color); text-decoration: underline;">/auth/spotify</a> to re-authenticate`;
				}
				
				// Create sets to track unique tracks and avoid duplicates
				const recentTrackIds = new Set();
				const topTrackIds = new Set();
				const uniqueRecent = [];
				const uniqueTop = [];
				
				// Get unique recent tracks
				for (const track of recentData.tracks) {
					const trackId = `${track.name}-${track.artist}`.toLowerCase();
					if (!recentTrackIds.has(trackId) && uniqueRecent.length < 5) {
						recentTrackIds.add(trackId);
						uniqueRecent.push(track);
					}
				}
				
				// Get unique top tracks that aren't already in recent
				for (const track of topData.tracks) {
					const trackId = `${track.name}-${track.artist}`.toLowerCase();
					if (!recentTrackIds.has(trackId) && !topTrackIds.has(trackId) && uniqueTop.length < 5) {
						topTrackIds.add(trackId);
						uniqueTop.push(track);
					}
				}
				
				let output = ``;
				
				// Recent tracks section - compact format
				output += `<span style="color: var(--accent-color);">Recent:</span><br>`;
				uniqueRecent.forEach((track, index) => {
					const trackLink = track.external_url ? 
						`<a href="${track.external_url}" target="_blank" style="color: var(--text-primary); text-decoration: underline;">${track.name}</a>` : 
						track.name;
					output += `<span style="color: var(--text-muted);">${index + 1}.</span> ${trackLink} <span style="color: var(--text-muted);">by ${track.artist}</span><br>`;
				});
				
				output += `<br>`;
				
				// Top tracks section - compact format  
				output += `<span style="color: var(--accent-color);">Top:</span><br>`;
				uniqueTop.forEach((track, index) => {
					const trackLink = track.external_url ? 
						`<a href="${track.external_url}" target="_blank" style="color: var(--text-primary); text-decoration: underline;">${track.name}</a>` : 
						track.name;
					output += `<span style="color: var(--text-muted);">${index + 1}.</span> ${trackLink} <span style="color: var(--text-muted);">by ${track.artist}</span><br>`;
				});
				
				return output;
			} catch (error) {
				console.error('Failed to fetch tracks:', error);
				return `<span style="color: #f38ba8;">Failed to load music data</span>`;
			}
		}

		// ===== INITIALIZATION =====
		document.getElementById('initial-about').innerHTML = MESSAGES.about;
		document.getElementById('initial-links').innerHTML = MESSAGES.links;

		// ===== COMMANDS =====
		const commands = {
			help: () => MESSAGES.help,
			whoami: () => MESSAGES.about,
			links: () => MESSAGES.links,
			contact: () => MESSAGES.contact,
			donate: () => MESSAGES.donate,
			music: async () => {
				const result = await showTopTracks();
				return result;
			},
			
			resume: () => {
				window.open('/taheralkamelresume.pdf', '_blank');
				return 'Opening resume in new tab...';
			},
			
			clear: () => {
				terminalOutput.innerHTML = '';
				terminalOutput.offsetHeight; // Force reflow
				return null;
			}
		};

		// ===== INPUT HANDLING =====
		terminalInput.addEventListener('keydown', (e) => {
			switch (e.key) {
				case 'Enter':
					e.preventDefault();
					const command = terminalInput.value.trim();
					if (command) {
						commandHistory.unshift(command);
						historyIndex = -1;
						executeCommand(command);
					}
					terminalInput.value = '';
					break;
					
				case 'ArrowUp':
					e.preventDefault();
					if (historyIndex < commandHistory.length - 1) {
						historyIndex++;
						terminalInput.value = commandHistory[historyIndex];
					}
					break;
					
				case 'ArrowDown':
					e.preventDefault();
					if (historyIndex > 0) {
						historyIndex--;
						terminalInput.value = commandHistory[historyIndex];
					} else if (historyIndex === 0) {
						historyIndex = -1;
						terminalInput.value = '';
					}
					break;
			}
		});

		// ===== COMMAND EXECUTION =====
		function createOutputElement(content, isError = false) {
			const element = document.createElement('div');
			element.className = 'command-output';
			element.style.display = 'block';
			element.style.visibility = 'visible';
			
			if (isError) {
				element.style.color = '#f38ba8';
				element.textContent = content;
			} else {
				element.innerHTML = content;
			}
			
			return element;
		}
		
		async function executeCommand(command) {
			// Log command execution to server
			try {
				fetch('/api/log/command', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify({ command: command.trim() })
				}).catch(() => {}); // Silently fail if logging fails
			} catch (error) {
				// Ignore logging errors
			}
			
			// Add command line to output
			const commandLine = document.createElement('div');
			commandLine.className = 'command-line';
			commandLine.innerHTML = `<span class="prompt">❯</span> ${command}`;
			terminalOutput.appendChild(commandLine);
			
			// Execute command
			const commandFunction = commands[command.toLowerCase()];
			if (commandFunction) {
				try {
					const result = await commandFunction();
					if (result !== null) {
						const outputElement = createOutputElement(result);
						terminalOutput.appendChild(outputElement);
					}
				} catch (error) {
					console.error('Command execution error:', error);
					const errorElement = createOutputElement('Command failed to execute', true);
					terminalOutput.appendChild(errorElement);
				}
			} else {
				const errorElement = createOutputElement(`bash: ${command}: command not found`, true);
				terminalOutput.appendChild(errorElement);
			}
			
			scrollToBottom();
		}

		// ===== KEYBOARD SHORTCUTS =====
		document.addEventListener('keydown', (e) => {
			if (e.key === 'c' && (e.ctrlKey || e.metaKey)) {
				e.preventDefault();
				const interrupt = document.createElement('div');
				interrupt.style.color = '#f38ba8';
				interrupt.textContent = '^C';
				terminalOutput.appendChild(interrupt);
				terminalInput.value = '';
			}
		});
	</script>
</body>
</html>
